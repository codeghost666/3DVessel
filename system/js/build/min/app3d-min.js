!function e(t,i,n){function a(r,s){if(!i[r]){if(!t[r]){var d="function"==typeof require&&require;if(!s&&d)return d(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[r]={exports:{}};t[r][0].call(c.exports,function(e){var i=t[r][1][e];return a(i?i:e)},c,c.exports,e,t,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(e,t,i){"use strict";var n=e("../core/vessels-3d.js"),a=e("../utils/js-helpers.js"),o=e("../utils/dom-utilities.js"),r=e("../core/i18labels.js"),s=document.getElementById("app-3d"),d=document.getElementById("titleH1"),l=document.getElementById("titleBay"),c=document.getElementById("info-window"),u=a.getQueryParams(),h,p,v;v={dropFilter:null,dropFilterValue:null,showWireframes:null,currentlyHidden:[],latestFilter:"",dropBays:null,dropBaysDictionary:{},dropAddHouse:null,openBayInfo:null,closeBayInfo:null,bayInfo:null,bayInfoTable:null,baySelected:"",shipHouseSpace:20.5,isExpanded:!1,prevnextCont:null,prevnextNum:1,numContsByBlock:null,hatchDecksVisible:!0,init:function m(){var e=document.getElementById("dropColors"),t=document.getElementById("dropFilter"),i=void 0,n=void 0,a=v,r=h.data.filters;a.dropFilterValue=document.getElementById("dropFilterValue"),a.showWireframes=document.getElementById("showWireframesFiltered"),a.expandViewBtn=document.getElementById("expandView"),a.prevnextCont=document.getElementById("prevnext-container"),a.dropFilter=t,n=document.createElement("option"),n.value="",n.innerHTML="None",t.appendChild(n);for(i in r)n=document.createElement("option"),n.value=i,n.innerHTML=r[i].name,t.appendChild(n),n=document.createElement("option"),n.value=i,n.innerHTML=r[i].name,e.appendChild(n);e.value="i",o.addEventLnr(t,"change",a.prepareFilter),o.addEventLnr(a.dropFilterValue,"change",a.processFilterValue),o.addEventLnr(e,"change",a.colorize),o.addEventLnr(a.showWireframes,"change",a.listenWireframeDisplay),o.addEventLnr(window,"keydown",a.checkKeyPressed),o.addEventLnr(a.expandViewBtn,"change",a.expandView),o.addEventLnr(document.getElementById("view-hcs"),"change",a.toggleHatchCovers),o.addEventLnr(document.getElementById("bay-next"),"click",a.expandViewNext),o.addEventLnr(document.getElementById("bay-prev"),"click",a.expandViewPrev),a.addBaysControl(),a.addHouseControl(),a.pauseControls(!1)},addBaysControl:function f(){function e(e){var t=e.target.value;m.isolateBay(t)}var t,i,n,r,s=document.getElementById("dropBays"),d=[],l,c,u,p,m=v,f,y=h.renderer3d.g3Bays,b=h.data.dataStructured,E=["<option value=''>All bays</option>"];for(t in y)r=y[t],r.children.length>0&&d.push(r.name.replace("b",""));for(d=d.sort(a.sortNumeric),i=0,n=d.length;n>i;i+=1)f=Number(d[i]),l=f%2===1,l?b[d[i]].n&&(E.push("<option value='"+d[i]+"'>"+d[i]+"</option>"),m.dropBaysDictionary[d[i]]=d[i]):(c=n>i+1&&Number(d[i+1])===f+1,c||m.dropBaysDictionary[a.pad(f-1,3)]||(E.push("<option value='"+a.pad(f,3)+"'>"+a.pad(f-1,3)+"</option>"),m.dropBaysDictionary[a.pad(f-1,3)]=a.pad(f,3)));s.innerHTML=E.join(""),m.dropBays=s,o.addEventLnr(m.dropBays,"change",e),m.openBayInfo=document.getElementById("open-panel"),m.closeBayInfo=document.getElementById("close-panel"),m.bayInfo=document.getElementById("bay-panel"),m.bayInfoTable=document.getElementById("bay-table-container"),o.addEventLnr(m.openBayInfo,"click",m.showBayInfo),o.addEventLnr(m.closeBayInfo,"click",m.showBayInfo),m.openBayInfo.style.left="-300px"},addHouseControl:function y(){var e=v,t=document.getElementById("dropAddHouse"),i=h.data.dataStructured,n,r,s,d,l=["<option value=''>No house</option>"];for(r=a.objKeysToArray(e.dropBaysDictionary),r=r.sort(a.sortNumeric),s=r.length-1;s>=0;s-=1)n=r[s],i[n].maxD>20&&l.push("<option value='"+e.dropBaysDictionary[n]+"'>before "+n+"</option>");t.innerHTML=l.join(""),o.addEventLnr(t,"change",e.moveShipHouseLnr),e.dropAddHouse=t},prepareFilter:function b(e){var t=e.target.value,i,n,a=["<option value=''>No filter</option>"],o=v,r=h.data.filters;if(!t)return o.pauseControls(!0),o.showHiddenMeshes(),o.pauseControls(!1),o.dropFilterValue.value="",o.dropFilterValue.innerHTML=a.join(""),void o.dropFilterValue.setAttribute("disabled","disabled");if(o.latestFilter!==t&&(o.pauseControls(!0),o.showHiddenMeshes(),o.pauseControls(!1)),o.latestFilter=t,o.dropFilterValue.removeAttribute("disabled"),o.dropFilterValue.innerHTML="",n=r[t],n.tf)a.push("<option value='1'>yes</option>"),a.push("<option value='0'>no</option>");else for(i in n.obs)a.push("<option value='"+i+"'>"+i+"</option>");o.dropFilterValue.innerHTML=a.join("")},processFilterValue:function E(e){var t=e.target.value,i=v,n=i.dropFilter,a,o,r,s=i.showWireframes.checked,d=h.data.filters,l=h.data.allContainerMeshesObj,c=[],u,p;if(i.pauseControls(!0),i.showHiddenMeshes(),""===t)return void i.pauseControls(!1);u=d[i.dropFilter.value].obs;for(r in u)if(i.dropFilterValue.value!==r)for(a=0,o=u[r].indexes.length;o>a;a+=1)p=l[u[r].indexes[a].c],s?(p.isBasic=!0,p.material=h.renderer3d.basicMaterial):p.visible=!1,c.push(u[r].indexes[a].c);i.currentlyHidden=c,i.pauseControls(!1)},processWireframeDisplay:function g(e){var t=v,i=t.currentlyHidden,n,a,o=h.data.allContainerMeshesObj,r=i.length;if(r)for(n=0;r>n;n+=1)a=o[i[n]],e?(a.isBasic=!0,a.material=h.renderer3d.basicMaterial,a.visible=!0):a.visible=!1},listenWireframeDisplay:function w(e){var t=e.target.checked,i=v;i.pauseControls(!0),i.processWireframeDisplay(t),i.pauseControls(!1)},showHiddenMeshes:function x(){var e=v.currentlyHidden,t,i,n=e.length,a=h.data.allContainerMeshesObj;if(n>0)for(t=0;n>t;t+=1)i=a[e[t]],i.isBasic&&(i.material=h.renderer3d.allMaterials[i.materialPos],i.isBasic=!1),i.visible=!0;v.currentlyHidden=[]},pauseControls:function T(e){var t=v,i;return e?(i=t.dropFilterValue.getAttribute("disabled"),t.dropFilter.setAttribute("disabled","disabled"),t.dropFilterValue.setAttribute("disabled","disabled"),t.dropFilterValue.setAttribute("prevAttr",i),t.showWireframes.setAttribute("disabled","disabled"),t.dropBays.setAttribute("disabled","disabled"),void t.dropAddHouse.setAttribute("disabled","disabled")):(i=t.dropFilterValue.getAttribute("prevAttr"),t.dropFilter.removeAttribute("disabled"),"disabled"!==i&&t.dropFilterValue.removeAttribute("disabled"),t.showWireframes.removeAttribute("disabled"),void(t.isExpanded||(t.dropBays.removeAttribute("disabled"),t.dropAddHouse.removeAttribute("disabled"))))},colorize:function R(e){var t=e.target.value,i,n,a,o,r=h.data.allContainerMeshesObj,s=h.data.filters,d=h.data.data;for(v.showColorsTable(t),i=0,n=d.info.contsL;n>i;i+=1)o=d.conts[i],a=r[o.cDash],a.materialPos=s[t].obs[o[t]].materialPos,a.isBasic||(a.material=h.renderer3d.allMaterials[a.materialPos])},isolateBay:function H(e){function t(e){function t(){var e=document.createElement("tr");for(R=0;y>=R;R+=1)H=a.pad(R,2),S=document.createElement("th"),S.innerHTML=H,R%2===0?e.appendChild(S):e.insertBefore(S,e.firstChild);return e.insertBefore(document.createElement("th"),e.firstChild),e.appendChild(document.createElement("th")),e}var i,n,o,s,d,l,c,h,v,f,y,b={},E,g,w=!1,x,T,R,H,B,C,M,S;if(o=e,o%2===0&&(w=!0,o-=1),l=e-1,m["b"+a.pad(l,3)]||(l+=2),m["b"+a.pad(l,3)]||(l=0),E=a.pad(o,3),g=a.pad(e,3),c=JSON.parse(JSON.stringify(u[E])),o!==e){h=JSON.parse(JSON.stringify(u[g]));for(i in c.cells){s=c.cells[i];for(n in s.tiers)d=s.tiers[n],0===d.p.indexOf(E)&&(c.cells[i].tiers[n]=null)}for(i in h.cells){s=h.cells[i];for(n in s.tiers)d=s.tiers[n],0===d.p.indexOf(g)&&(c.cells[i]||(c.cells[i]={tiers:{}}),c.cells[i].tiers[n]=d)}}for(i in c.cells)for(n in c.cells[i].tiers)b[n]||(b[n]=1);for(v=a.objKeysToArray(c.cells,!0),f=a.objKeysToArray(b,!0),y=Number(v[v.length-1]),C=document.createElement("table"),C.setAttribute("align","center"),M=t(),C.appendChild(M),x=f.length-1;x>=0;x-=1){for(M=document.createElement("tr"),M.setAttribute("data-tier",f[x]),C.appendChild(M),R=0;y>=R;R+=1)H=a.pad(R,2),S=document.createElement("td"),S.id="td_"+H+"_"+f[x],c.cells[H]&&c.cells[H].tiers[f[x]]?(d=c.cells[H].tiers[f[x]],B=[],B.push(d.s?"F <br />":"e <br />"),B.push("<span class='dest' style='background:"+p.d.obs[d.d].color+"'>"+d.d+"</span><br />"),B.push("<span class='haz "+(d.w?"isHaz":"")+"'>"+(d.w?"HAZARDOUS":"")+"</span>"),B.push("<span class='cont'>"+d.c.substr(0,4)+"<br />"+d.c.substr(4)+"</span> "),B.push("<span class='opr' style='background:"+p.o.obs[d.o].color+"'>"+d.o+"</span><br />"),B.push("<span class='iso'>"+d.i+"</span><br />"),B.push("<span class='mt'>"+d.m+"MT</span> "),S.innerHTML=B.join("")):(S.innerHTML="&nbsp;",S.className="empty"),R%2===0?M.appendChild(S):M.insertBefore(S,M.firstChild);S=document.createElement("td"),S.innerHTML=f[x],S.className="th",M.insertBefore(S,M.firstChild),S=document.createElement("td"),S.innerHTML=f[x],S.className="th",M.appendChild(S)}M=t(),C.appendChild(M),r.bayInfoTable.innerHTML="",r.bayInfoTable.appendChild(C)}function i(e,t,i,n,o){var r,s,d,l,c,u,p;c=e-1,m["b"+a.pad(c,3)]||(c+=2);for(r in m)p=m[r],s=Number(p.name.replace("b","")),s!==e&&s!==c&&(e>s?TweenLite.to(p.position,t,{z:p.originalZ-i,delay:n,ease:Power2.easeInOut}):TweenLite.to(p.position,t,{z:p.originalZ+i,delay:n,ease:Power2.easeInOut}));return h.renderer3d.shipHouse.mesh.visible&&(u=e<f.currPosBay?i:-i,TweenLite.to(f.mesh.position,t,{z:f.currPosZ+u,delay:n,ease:Power2.easeInOut})),d=m["b"+a.pad(e,3)],l=m["b"+a.pad(c,3)],d&&TweenLite.to(d.position,t,{y:o,delay:.5,ease:Power2.easeInOut}),l&&TweenLite.to(l.position,t,{y:o,delay:.5,ease:Power2.easeInOut}),d.originalZ}function n(e){var t,n,a,o,r,u,p,m,f,y,b,E=v,g,w,x,T=h.options,R=h.renderer3d.controls,H=h.renderer3d.camera.position;E.pauseControls(!0),E.expandViewBtn.setAttribute("disabled","disabled"),x=""!==E.baySelected,x?(i(Number(E.baySelected),.35,0,0,0),s>0&&(c=i(s,.4,d,.75,l))):c=i(s,1,d,0,l),""!==e?(E.baySelected=e,o=c+250,r=l,u=0,p=l-10,b=.5,R.dampingFactor=T.dampingFactorIn,g=30,c+=11):(E.baySelected="",o=E.initialCameraPosition.z,r=E.initialCameraPosition.y,u=E.initialCameraPosition.x,p=0,c=E.initialCameraPosition.targetZ,b=0,R.dampingFactor=T.dampingFactorOut,g=-300),TweenLite.to(H,1,{x:u,y:r,z:o,delay:b,ease:Power2.easeInOut}),TweenLite.to(R.target,2,{y:p,x:0,z:c,ease:Power2.easeInOut}),TweenLite.to(E.openBayInfo,1,{left:g,delay:4*b,ease:Power2.easeInOut}),setTimeout(function(){E.expandViewBtn.removeAttribute("disabled"),E.pauseControls(!1)},2500)}var o=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],r=v,s=Number(e),d=40,l=500,c,u=h.data.dataStructured,p=h.data.filters,m=h.renderer3d.g3Bays,f=h.renderer3d.shipHouse;n(e?e:""),e?(r.dropAddHouse.setAttribute("disabled","disabled"),t(s)):r.dropAddHouse.removeAttribute("disabled")},showBayInfo:function B(e){var t="open-panel"===e.target.id,i=v;t?(i.bayInfo.style.display="block",h.pauseRendering()):(i.bayInfo.style.display="none",h.resumeRendering())},tryToLaunchBay:function C(e){var t=v,i=h.data.dataStructured,n,o;if(e&&"n"!==e){if(i[e])return t.dropBays.value=t.dropBaysDictionary[e],void t.isolateBay(e);n=Number(e),o=a.pad(n+1,3),i[o]&&(t.dropBays.value=o,t.isolateBay(o))}},moveShipHouseLnr:function M(e){var t=e.target.value;v.moveShipHouse(t)},moveShipHouse:function S(e){var t,i,n,a=v,o,r,s,d=h.renderer3d.shipHouse,l=h.renderer3d.g3Bays,c=h.renderer3d.hatchCovers,u=a.shipHouseSpace;if(h.pauseRendering(),d.currPosBay>0)for(t in l)i=l[t],n=Number(i.name.replace("b","")),n<d.currPosBay&&(i.position.z+=u,i.originalZ+=u,c[t]&&(c[t].position.z+=u,c[t].originalZ+=u));if(""===e)return d.mesh.visible=!1,void h.resumeRendering();d.currPosBay=Number(e);for(t in l)i=l[t],n=Number(i.name.replace("b","")),n<d.currPosBay&&(i.position.z-=u,i.originalZ-=u,c[t]&&(c[t].position.z-=u,c[t].originalZ-=u));d.mesh.visible=!0,d.mesh.position.z=l["b"+e].position.z-u-.5,d.currPosZ=Number(d.mesh.position.z),h.resumeRendering()},checkKeyPressed:function k(e){var t=v;switch(e.keyCode){case 27:if(t.isExpanded)return;""!==t.baySelected?(t.dropBays.value="",t.bayInfo.style.display="none",h.renderer3d._isRendering=!0,t.isolateBay("")):TweenLite.to(h.renderer3d.camera.position,1,{y:t.initialCameraPosition.y,x:t.initialCameraPosition.x,z:t.initialCameraPosition.z,ease:Power2.easeInOut})}},showColorsTable:function D(e){var t=document.getElementById("tableColors"),i=[],n,e,a,o,r=h.data.filters;a=r[e].tf;for(n in r[e].obs)o=r[e].obs[n],a?i.push("<li><span style='background:"+o.color+"'></span>"+("1"===n?"yes":"no")+"</li>"):i.push("<li><span style='background:"+o.color+"'></span>"+n+"</li>");t.innerHTML=i.join("")},expandView:function L(e){function t(){if(!o.numContsByBlock){var e={},t=void 0,i=void 0,n=h.data.numContsByBay;for(t=1;g+1>=t;t+=1)i=a.pad(t,3),d=u["b"+i],d&&(e[d.compactBlockNum]||(e[d.compactBlockNum]={n:0}),e[d.compactBlockNum].n+=n[i]||0);o.numContsByBlock=e}}function i(){var e=void 0;for(o.dropBays.setAttribute("disabled","disabled"),o.dropAddHouse.setAttribute("disabled","disabled"),""!==o.baySelected&&(o.openBayInfo.style.left="-300px"),c=1;g+1>=c;c+=1)l=a.pad(c,3),d=u["b"+l],d&&(e=o.numContsByBlock[d.compactBlockNum],d.isBlockStart&&e.n&&(b-=y,d.labels.visible=!0),d.position.z=1&c&&!d.isBlockStart?22.5+f:0,d.position.x=b,d.position.y=0);o.prevnextNum=1,o.expandedArrowPrev.className="prevnext bay-prev noselect ",h.renderer3d.simpleDeck.visible=!1,h.renderer3d.hatchDeck.visible=!1,h.renderer3d.shipHouse.prevVisible=h.renderer3d.shipHouse.mesh.visible,h.renderer3d.shipHouse.mesh.visible=!1,h.renderer3d.camera.position.set(0,-2,.8*-y),h.renderer3d.controls.target.set(0,0,20),o.prevnextCont.style.display="block",o._showBaysHatchCovers(o.hatchDecksVisible)}function n(){for(l in u)d=u[l],d.position.z=d.originalZ,d.position.x=0,d.position.y=0,d.labels&&(d.labels.visible=!1);var e=v.initialCameraPosition;h.renderer3d.setCameraPosition(e.x,e.y,e.z),h.renderer3d.controls.target.x=0,h.renderer3d.controls.target.y=0,h.renderer3d.controls.target.z=e.targetZ,h.renderer3d.simpleDeck.visible=!0,h.renderer3d.hatchDeck.visible=o.hatchDecksVisible,h.renderer3d.shipHouse.mesh.visible=h.renderer3d.shipHouse.prevVisible,o.prevnextCont.style.display="none",o.pauseControls(!1)}var o=v,r=e.target.checked,s=void 0,d=void 0,l=void 0,c=void 0,u=h.renderer3d.g3Bays,p=h.data.dataStructured,m=h.renderer3d.maxWidth,f=h.options.extraSep,y=m*(9.5+f)*1.5,b=y,E=!0,g=h.data.lastBay;o.expandedArrowPrev=document.getElementById("bay-prev"),o.expandedArrowNext=document.getElementById("bay-next"),t(),o.isExpanded=r,h.pauseRendering(),(r?i:n)(),h.resumeRendering()},expandViewNext:function P(){v.expandViewNextPrev(!0)},expandViewPrev:function N(){v.expandViewNextPrev(!1)},expandViewNextPrev:function _(e){function t(){var t=void 0,n=void 0;s=i.prevnextNum;do if(s+=e?1:-1,0>=s||s>h.renderer3d.maxCompactBlockNums)return null;while(i.numContsByBlock[s].n<=0);for(i.expandedArrowPrev.className="prevnext bay-prev noselect "+(s>1?"active":""),i.expandedArrowNext.className="prevnext bay-next noselect "+(s===h.renderer3d.maxCompactBlockNums?"":"active"),n=1;l+1>=n;n+=1)if(o=a.pad(n,3),t=d["b"+o],t&&t.compactBlockNum===s&&i.numContsByBlock[t.compactBlockNum].n)return t;return null}var i=v,n=.5,o=void 0,r=void 0,s=void 0,d=h.renderer3d.g3Bays,l=h.data.lastBay,c=function u(e,t){return e?t:!t};r=t(),r&&(TweenLite.to(h.renderer3d.camera.position,n,{x:r.position.x,ease:Power2.easeInOut}),TweenLite.to(h.renderer3d.controls.target,n,{x:r.position.x,ease:Power2.easeInOut}),i.prevnextNum=s)},toggleHatchCovers:function j(e){var t=v,i=e.target.checked,n=h.renderer3d.hatchDeck;t.hatchDecksVisible=i,t.isExpanded?(n.visible=!1,t._showBaysHatchCovers(i)):(n.visible=i,t._showBaysHatchCovers(!1))},_showBaysHatchCovers:function I(e){var t=void 0,i=void 0,n=h.renderer3d.g3Bays;for(t in n)i=n[t],i.isBlockStart&&i.hatchC&&(i.hatchC.visible=e)}},h=new n.VesselsApp3D(s,d,c,l),h.loadUrl(u.json,r.LOADING_DATA).then(function(e){var t=h.renderer3d,i=h.modelsFactory,n=void 0,a=void 0;h.updateHtmlTitle(e.VesselName,e.PlaceOfDeparture,e.VoyageNumber),h.data=h.loadData(e);for(var o=0,r=h.data.data.info.contsL;r>o;o+=1){var s=h.data.data.conts[o];t.createBay(s.bay),i.addIsoModel(s)}i.extendSpecs(h.data.filters),t.createBaseModels(i.isoModels),t.create3dContainersFromData(h.data),h.data.data.conts[0]&&t.putInfoWindow(h.data.data.conts[0]),v.init(),v.showColorsTable("i"),v.tryToLaunchBay(h.initialBay),n=t.maxDepth,a=Math.round(n/2),v.initialCameraPosition=t.setCameraPosition(-Math.round(.75*n),350,Math.round(.5*n)),t.controls.maxDistance=1.5*n,t.controls.target.z=a,v.initialCameraPosition.targetZ=a},function(e){h._node.loadingDiv.setMessage(e,!0),h._node.loadingDiv.updateLoader(0,1)}),window.appVessels3D=h},{"../core/i18labels.js":3,"../core/vessels-3d.js":6,"../utils/dom-utilities.js":10,"../utils/js-helpers.js":11}],2:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("./i18labels.js"),r=e("../utils/js-helpers.js"),s=e("../utils/dom-utilities.js"),d=function(){function e(t){n(this,e),this.divLoading=t}return a(e,[{key:"loadUrl",value:function t(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1],i=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=this;return new Promise(function(a,r){function d(e){var t=void 0;try{200===l.status?(t=JSON.parse(l.responseText),a(t)):r(l.statusText)}catch(i){r(o.ERROR_PARSING_JSON+" "+i.description)}}var l=void 0,c=function h(e){n.divLoading&&(n.divLoading.setMessage(e.responseText,!0),n.divLoading.updateLoader(0,1)),console.error(e)},u=function p(e){if(e.lengthComputable){var t=e.loaded/e.total;n.divLoading.updateLoader(t,.5)}};return n.divLoading.show(),e?(n.divLoading.show(),n.divLoading.startAnimation(),t&&n.divLoading.setMessage(t),l=new XMLHttpRequest,s.addEventLnr(l,"load",d),s.addEventLnr(l,"error",c),(n.divLoading||null!==i)&&s.addEventLnr(l,"progress",i||u),l.open("GET",e+(e.indexOf("?")>0?"&":"?")+"t="+1*new Date),void l.send()):void r(o.INVALID_DATA_SOURCE)})}},{key:"generateStructuredData",value:function i(e){function t(e){var t=e.bay,i=e.iBay;i%2===0&&(t=r.pad(i-1,3)),B[e.bay]?B[e.bay]+=1:B[e.bay]=1,g[t]||(g[t]={cells:{},n:0},g.n+=1,g[t].maxD=20),g[t].cells[e.cell]||(g[t].cells[e.cell]={tiers:{},n:0},g[t].n+=1,H||"00"!==e.cell||(H=!0)),g[t].cells[e.cell].tiers[e.tier]=e,g[t].cells[e.cell].n+=1,R<g[t].n&&(R=g[t].n),e.depth>g[t].maxD&&(g[t].maxD=e.depth),s.tier<"78"?(y.tiers[s.tier]||(y.tiers[s.tier]={h:e.h,accH:0},y.n+=1),e.h>y.tiers[s.tier].h&&(y.tiers[s.tier].h=e.h)):b.tiers[s.tier]||(b.tiers[s.tier]={h:e.h,accH:0},b.n+=1)}function i(e,t,i){w[e]={name:t,obs:{},tf:i}}function n(e){w.s.obs[e.s]||(w.s.obs[e.s]={c:1,indexes:[]}),w.i.obs[e.i]||(w.i.obs[e.i]={c:1,indexes:[]}),w.r.obs[e.r]||(w.r.obs[e.r]={c:1,indexes:[]}),w.w.obs[e.w]||(w.w.obs[e.w]={c:1,indexes:[]}),w.o.obs[e.o]||(w.o.obs[e.o]={c:1,indexes:[]}),w.d.obs[e.d]||(w.d.obs[e.d]={c:1,indexes:[]}),w.f.obs[e.f]||(w.f.obs[e.f]={c:1,indexes:[]}),w.t.obs[e.t]||(w.t.obs[e.t]={c:1,indexes:[]}),w.x.obs[e.x]||(w.x.obs[e.x]={c:1,indexes:[]}),w.s.obs[e.s].indexes.push(e),w.i.obs[e.i].indexes.push(e),w.r.obs[e.r].indexes.push(e),w.w.obs[e.w].indexes.push(e),w.o.obs[e.o].indexes.push(e),w.d.obs[e.d].indexes.push(e),w.f.obs[e.f].indexes.push(e),w.t.obs[e.t].indexes.push(e),w.x.obs[e.x].indexes.push(e)}var a=void 0,o=void 0,s=void 0,d=void 0,l=void 0,c=void 0,u=0,h=0,p=0,v={},m={},f={},y=void 0,b=void 0,E=void 0,g=void 0,w=void 0,x=void 0,T=void 0,R=0,H=!1,B={},C={},M={};for(E={conts:e["3DVesselData"],info:{contsL:e["3DVesselData"].length}},g={n:0},y={n:0,tiers:{}},b={n:0,tiers:{}},w={},i("i","Container ISO",!1),i("s","Full",!0),i("r","Reefer",!0),i("w","Hazardous",!0),i("t","Tank",!0),i("x","OOG",!0),i("o","Operator",!1),i("d","Destination",!1),i("f","Load Port",!1),o=0,a=E.conts.length;a>o;o+=1)s=E.conts[o],s.bay=s.p.substr(0,3),s.cell=s.p.substr(3,2),s.tier=s.p.substr(5,2),s.h=Number(Math.floor(s.h))+5*(s.h-Math.floor(s.h))/6,s.depth=Number(Math.floor(s.l))+5*(s.l-Math.floor(s.l))/6,s.iBay=Number(s.bay),s.iTier=Number(s.tier),s.myJ=o,s.cDash=s.c.replace(/\s/gi,"-"),C["cont_"+s.cDash]=s,t(s),n(s);return x=Number(_.min(_.keys(y.tiers))),T=Number(_.min(_.keys(b.tiers))),{data:E,dataStructured:g,belowTiers:y,aboveTiers:b,containersIDs:C,numContsByBay:B,allContainerMeshesObj:M,filters:w,iTierMin:x,iTierMinAbove:T,maxWidth:R,firstBay:_.min(_.keys(g)),lastBay:_.max(_.keys(g)),hasZeroCell:H}}}]),e}();i.DataLoader=d},{"../utils/dom-utilities.js":10,"../utils/js-helpers.js":11,"./i18labels.js":3}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n="Loading 3D Model...";i.LOADING_DATA=n;var a="Error: Missing data source.";i.INVALID_DATA_SOURCE=a;var o="Error while parsing the JSON file.";i.ERROR_PARSING_JSON=o},{}],4:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("../utils/random-color.js"),r=function(){function e(t){n(this,e),this.models={},this.isoModels={},this.appScene=t}return a(e,[{key:"addIsoModel",value:function t(e){var t=this,i=t.isoModels;i[e.i]||(i[e.i]={d:e.depth,h:e.h,t:e.t})}},{key:"extendSpecs",value:function i(e){var t,i,n,a,r,s,d=this,l,c,u=new o.RColor,h,p,v=this.appScene.renderer3d;for(n in e){r=e[n];for(a in r.obs)s=r.obs[a],h=u.get(!0),p=parseInt(h.replace(/^#/,""),16),c=v.addContainerMaterial(p),s.color=h,s.hexColor=p,s.materialPos=c}}}]),e}();i.ModelsFactory=r},{"../utils/random-color.js":13}],5:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("../utils/js-helpers.js"),r=e("../utils/dom-utilities.js"),s=e("../text2D/SpriteText2D.js"),d=e("../text2D/textAlign.js"),l=function(){function e(t,i,a){n(this,e),this.scene=null,this.renderer=null,this.camera=null,this.raycaster=new THREE.Raycaster,this.mouseVector=new THREE.Vector2,this.controls=null,this.appScene=t,this.container=t._node,this.width=i,this.height=a,this.frames=0,this._INTERSECTED=null,this.followMouseEvents=!1,this.mouseStart=new THREE.Vector2,this.mouseLastClick=new Date,this._isRendering=!0,this._floatingCamera=!0,this._modelsLoaded={},this.g3Bays={},this.models={},this.maxDepth=0,this.maxWidth=0,this.shipHouse=null,this.simpleDeck=null,this.hatchCover=null,this.hatchCovers={},this.allMaterials=[],this.basicMaterial=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.3,wireframe:!0}),this.selectionMaterial=new THREE.MeshStandardMaterial({color:0,side:THREE.DoubleSide,opacity:1,transparent:!1}),this.containersGroup=null}return a(e,[{key:"init",value:function t(){function e(e,t,i){var n=new THREE.DirectionalLight(16777215,.3);return n.position.set(e,t,i),n.castShadow=!0,n.shadow.camera.left=-s,n.shadow.camera.right=s,n.shadow.camera.top=s,n.shadow.camera.bottom=-s,n.shadow.camera.far=1600,n.shadow.camera.near=1,n}var t=this,i=void 0,n=void 0,a=void 0,o=void 0,s=800,d=this.appScene.options;if(null===this.container||void 0===this.container)return void console.error("Container is null. Halting.");if(!this.width)return void console.error("Width is null or zero. Halting.");if(!this.height)return void console.error("Height is null or zero. Halting.");this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setClearColor(d.colors.background,1),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.container.divRenderC.appendChild(this.renderer.domElement),this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,3e4),this.camera.position.z=d.initialCameraPosition.z,this.camera.position.x=d.initialCameraPosition.x,this.camera.position.y=d.initialCameraPosition.y,this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=d.dampingFactorOut||.2,this.controls.minPolarAngle=Math.PI/5,this.controls.maxPolarAngle=Math.PI/5*4,this.controls.maxDistance=2*d.initialCameraPosition.z,this.controls.minDistance=d.initialCameraPosition.z/2,this.controls.enableKeys=!1,this.controls.enablePan=!1,this.raycaster=new THREE.Raycaster,this.mouseVector=new THREE.Vector2,a=new THREE.Group,n=e(-s,s,-s),a.add(n),n=e(s,s,-s),a.add(n),n=e(s,s,s),a.add(n),n=e(-s,s,s),a.add(n),n=new THREE.DirectionalLight(16316398,.15),n.position.set(0,-300,-50),a.add(n),this.lightsGroup=a,n=new THREE.AmbientLight(d.colors.sunlight,.7),this.scene.add(n),this.scene.add(a);var l=new THREE.Object3D;this.scene.add(l),this.containersGroup=l,r.addEventLnr(window,"mousemove",function(e){t.mouseVector.x=e.clientX/t.width*2-1,t.mouseVector.y=2*-(e.clientY/t.height)+1})}},{key:"createBay",value:function i(e){var t=this,i=void 0,n=void 0,a=void 0;return t.g3Bays["b"+e]?t.g3Bays["b"+e]:(i=new THREE.Group,i.name="b"+e,i.iBay=Number(e),i.isBlockStart=!1,t.g3Bays["b"+e]=i,t.containersGroup.add(i),i)}},{key:"_addLabelsToBay",value:function l(e,t,i){var n=arguments.length<=3||void 0===arguments[3]?"FWD":arguments[3],a=arguments.length<=4||void 0===arguments[4]?"AFT":arguments[4],o=void 0,r=this.appScene.data.aboveTiers.n,l=this.appScene.options.extraSep,c=this.appScene.options.labelScale||2;o=new THREE.Group,o.name="labels",o.visible=!1,e.labelsCanBeVisible=!0;var u=new s(n,{align:d.center,font:"32px Arial",fillStyle:"#888888"});u.position.z=-15,u.scale.set(c,c,1),o.add(u),u=new s(a,{align:d.center,font:"32px Arial",fillStyle:"#888888"}),u.position.z=60,u.scale.set(c,c,1),o.add(u),e.add(o),e.labels=o,o.position.y=t,o.position.z=i}},{key:"addContainerMaterial",value:function c(e){var t=new THREE.MeshStandardMaterial({color:e,side:THREE.DoubleSide,transparent:!0,opacity:1});return this.allMaterials.push(t),this.allMaterials.length-1}},{key:"createBaseModels",value:function u(e){var t=this,i,n,a,o,r,s,d=this.appScene.data.filters,l,c;for(i in e)n=e[i],a=n.h,r=d.i.obs[i],n.t?(l=new THREE.CylinderGeometry(4,4,n.d,16),c=new THREE.Mesh(l,t.allMaterials[r.materialPos]),l.translate(-4,n.d/2,-4),c.rotation.z=-Math.PI/2,c.rotation.y=-Math.PI/2):(o=new THREE.Shape([new THREE.Vector2(0,0),new THREE.Vector2(0,a),new THREE.Vector2(8,a),new THREE.Vector2(8,0)]),l=new THREE.ExtrudeGeometry(o,{bevelEnabled:!1,steps:1,amount:n.d}),c=new THREE.Mesh(l,t.allMaterials[r.materialPos])),c.materialPos=r.materialPos,c.dynamic=!0,this.models[i]=c}},{key:"create3dContainersFromData",value:function h(e){var t=this,i=e.data,n=e.belowTiers,a=e.aboveTiers,r=e.iTierMin,s=e.iTierMinAbove,d=e.dataStructured,l=e.allContainerMeshesObj,c=e.numContsByBay,u=this.g3Bays,h=this.appScene._node.loadingDiv,p=this.appScene.options.extraSep,v=void 0,m=i.info.contsL,f=void 0,y=void 0,b=void 0,E=void 0,g=void 0,w=void 0,x=void 0,T=void 0,R=void 0,H=void 0,B=void 0,C=void 0,M=void 0,S=0,k=void 0,D=void 0,L=void 0,P=void 0,N=void 0,j=void 0,I=void 0,A=4,V=4-p,O=void 0,F=void 0,z=void 0,W=void 0,U=void 0,G=void 0,Z=void 0,J=[],K=void 0,q=void 0,Q=void 0,X=void 0,Y={},ee=new THREE.MeshStandardMaterial({color:6710886}),te=function ie(e,t){e.p===t.p?0:e.p<t.p?-1:1};for(O=_.max(_.keys(d)),U=d[O].maxD,V=_.reduce(n.tiers,function(e,t){return e+t.h+p},0)+V,K=0,v=1;O>=v;v+=2)y=o.pad(v,3),q=o.pad(v+1,3),Q=o.pad(v-1,3),X=u["b"+q],d[y]||(d[y]={cells:{},n:0,z:0}),v%2===1&&(S+=22.5+p),d[y].z=S,G=t.createBay(y),G.position.z=S,G.originalZ=S,G.isBlockStart=!0,X&&(X.position.z=S,X.originalZ=S),c[Q]&&(G.isBlockStart=!1),G.isBlockStart&&(K+=1,this._addLabelsToBay(G,a.n*(9.5+p),0)),G.compactBlockNum=K,X&&(X.compactBlockNum=K);for(Z=S+U,this.maxDepth=Z,this.maxWidth=e.maxWidth,this.maxCompactBlockNums=K,v=0,m=i.info.contsL;m>v;v+=1)T=i.conts[v],R=t.models[String(T.i)],F=T.iBay,z=Number(T.cell),k=(z%2===0?z/2:-(z+1)/2)*(8+p),W=Number(T.tier),D=W>=78?(W-s)/2*(9.5+p)+A:(W-r)/2*(9.5+p)-V,H=R.clone(),H.materialPos=R.materialPos,H.name="cont_"+T.cDash,H.objRef=T,H.position.x=k,H.position.y=D,H.position.z=0,H.updateMatrix(),H.matrixAutoUpdate=!1,H.isBasic=!1,u["b"+T.bay].add(H),l[T.cDash]=H;t._createShipDeck(),t._createHouse(a.n),t._createHatchCovers(),h.stopAnimation(),setTimeout(function(){h.hide()},500)}},{key:"_createHatchCovers",value:function p(){function e(e){var t=void 0,i=void 0,n=void 0,a=void 0,o=void 0;n=5===e||6===e||9===e?3:4>=e?e:4,t=e/n,i=Math.ceil(t),o=new Array(i);for(var r=0;i>r;r+=1)o[r]=n;return a=Math.ceil((t-Math.floor(t))*n),a>0&&(o[Math.floor(i/2)]=a),o}function t(e,t){var n=void 0,a=void 0,o=void 0,r=e*(8+i)-i;return n=new THREE.Shape([new THREE.Vector2(-r,0),new THREE.Vector2(-r,t),new THREE.Vector2(0,t),new THREE.Vector2(0,0)]),a=new THREE.ExtrudeGeometry(n,{bevelEnabled:!1,steps:1,amount:3}),o=new THREE.Mesh(a,S),o.rotation.x=Math.PI/2,a.translate(8.5+i,0,0),o}var i=this.appScene.options.extraSep,n=this.maxWidth,a=this.maxDepth,r=n*(8+i),s=this.appScene.data.dataStructured,d=this.g3Bays,l=this.appScene.data.lastBay,c=this.appScene.data.hasZeroCell?1:0,u=[],h=void 0,p=void 0,v=void 0,m=void 0,f=[],y=void 0,b=0,E=void 0,g=new THREE.Group,w=void 0,x=void 0,T=void 0,R=void 0,H=void 0,B=void 0,C=void 0,M=void 0,S=new THREE.MeshStandardMaterial({color:6710886}),k=60,D=function O(e){return(e%2===0?e/2:-(e+1)/2)*(8+i)};for(h=1;l+1>=h;h+=2)v=o.pad(h,3),m=d["b"+v],m&&(!f[m.compactBlockNum]||f[m.compactBlockNum].cells<s[v].n?f[m.compactBlockNum]={baseBay:m.iBay,cbn:m.compactBlockNum,cells:s[v].n,maxD:s[v].maxD,posLeft:Number(_.max(_.filter(_(s[v].cells).keys(),function(e){return Number(e)%2===0}),function(e){return Number(e)})),posRight:Number(_.max(_.filter(_(s[v].cells).keys(),function(e){return Number(e)%2===1}),function(e){return Number(e)}))}:(f[m.compactBlockNum].posLeft=Math.max(f[m.compactBlockNum].posLeft,Number(_.max(_.filter(_(s[v].cells).keys(),function(e){return Number(e)%2===0}),function(e){return Number(e)}))),f[m.compactBlockNum].posRight=Math.max(f[m.compactBlockNum].posRight,Number(_.max(_.filter(_(s[v].cells).keys(),function(e){return Number(e)%2===1}),function(e){return Number(e)})))),b=m.compactBlockNum);for(f[1].maxLeftUp=f[1].posLeft,f[1].maxRightUp=f[1].posRight,f[b].maxLeftDown=f[b].posLeft,f[b].maxRightDown=f[b].posRight,h=2,p=b+1;p>h;h+=1)f[h].maxLeftUp=Math.max(f[h-1].maxLeftUp,f[h].posLeft),f[h].maxRightUp=Math.max(f[h-1].maxRightUp,f[h].posRight),f[p-h].maxLeftDown=Math.max(f[p-h+1].maxLeftDown,f[p-h].posLeft),f[p-h].maxRightDown=Math.max(f[p-h+1].maxRightDown,f[p-h].posRight);for(h=1,p=b+1;p>h;h+=1)f[h].maxLeft=Number(Math.min(f[h].maxLeftUp,f[h].maxLeftDown)),f[h].maxRight=Number(Math.min(f[h].maxRightUp,f[h].maxRightDown)),E=Math.max(f[h].maxLeft,f[h].maxRight),C=f[h].maxD?f[h].maxD<=20?22.5:f[h].maxD<=45?45:60:22.5,0!==C&&(1===h?u.push({d:C,l:f[h].maxLeft,b:f[h].baseBay,hts:e(E+c)}):f[h].maxLeft===f[h-1].maxLeft&&f[h].maxRight===f[h-1].maxRight&&u[u.length-1].d+(f[h].maxD||45)<=k?u[u.length-1].d+=f[h].maxD||45:u.push({d:C,l:f[h].maxLeft,b:f[h].baseBay,hts:e(E+c)}));for(B=22.5,h=0,p=u.length;p>h;h+=1){x=u[h],M=new THREE.Group,M.name="baseBay-"+x.b,M.baseBay=x.b,this.hatchCovers["b"+o.pad(x.b,3)]=M,R=x.l,H=D(R);for(var L=0,P=x.hts.length;P>L;L+=1)T=x.hts[L],w=t(T,x.d),w.position.x=H-2*i,M.add(w),H-=T*(8+i);M.position.z=B,M.originalZ=B,g.add(M),B+=x.d+2*i}for(v in d)if(m=d[v],
m.isBlockStart){if(y=f[m.compactBlockNum],!y.maxD)continue;var N=D(y.maxLeft),j=D(y.maxRight),I=new THREE.Shape([new THREE.Vector2(N+c*(8+i),0),new THREE.Vector2(j,0),new THREE.Vector2(j,y.maxD),new THREE.Vector2(N+c*(8+i),y.maxD)]),A=new THREE.ExtrudeGeometry(I,{bevelEnabled:!1,steps:1,amount:2}),V=new THREE.Mesh(A,S);V.rotation.x=Math.PI/2,V.position.y=1,V.visible=!1,m.add(V),m.hatchC=V}this.scene.add(g),g.position.y=1.5,this.hatchDeck=g}},{key:"_createShipDeck",value:function v(){var e=new THREE.LineBasicMaterial({color:4033704,opacity:1,linewidth:2}),t=this.appScene.options.extraSep,i=this.maxWidth,n=this.maxDepth,a=void 0,o=new THREE.CurvePath,r=void 0,s=void 0,d=i*(8+t)/4;o.add(new THREE.EllipseCurve(4,20,d,3*d,Math.PI,0,!1)),o.add(new THREE.EllipseCurve(4,n,d,.75*d,0,Math.PI,!1)),o.closePath(),r=o.createPointsGeometry(150),s=new THREE.Line(r,e),s.rotation.x=Math.PI/2,this.scene.add(s),this.simpleDeck=s}},{key:"_createHouse",value:function m(e){var t=this.appScene.options.extraSep,i=this.maxWidth,n=this.appScene.data.belowTiers,a=i*(8+t)/2*.9,o=Math.max(1,e)*(9.5+t)+6,r,s,d,l,c=Math.max(1,.7*n.n),u=c*(9.5+t),h=c*(8+t)/2,p,v=new THREE.MeshPhongMaterial({color:6075098,side:THREE.DoubleSide}),m=new THREE.MeshPhongMaterial({color:11184810,side:THREE.DoubleSide});s=new THREE.Shape([new THREE.Vector2(0,-u),new THREE.Vector2(-h,-u),new THREE.Vector2(-a,0),new THREE.Vector2(-a,o),new THREE.Vector2(-a-.25*a,o+10),new THREE.Vector2(-a-.25*a,o+20),new THREE.Vector2(-a,o+20),new THREE.Vector2(-a+.125*i,o+24),new THREE.Vector2(a-.125*i,o+24),new THREE.Vector2(a,o+20),new THREE.Vector2(a+.25*a,o+20),new THREE.Vector2(a+.25*a,o+10),new THREE.Vector2(a,o),new THREE.Vector2(a,0),new THREE.Vector2(h,-u),new THREE.Vector2(0,-u)]),r=new THREE.ExtrudeGeometry(s,{bevelEnabled:!1,steps:1,amount:20}),d=new THREE.Mesh(r,m),d.matrixAutoUpdate=!1,p=new THREE.Object3D,p.name="house",p.add(d),s=new THREE.Shape([new THREE.Vector2(-1.125*a,0),new THREE.Vector2(-1.125*a,7),new THREE.Vector2(1.125*a,7),new THREE.Vector2(1.125*a,0)]),l=new THREE.ShapeGeometry(s),d=new THREE.Mesh(l,v),d.position.y=o+10,d.position.z=-.25,d.matrixAutoUpdate=!1,d.updateMatrix(),p.add(d),d=new THREE.Mesh(l,v),d.position.y=o+10,d.position.z=20.25,d.matrixAutoUpdate=!1,d.updateMatrix(),p.add(d),l=new THREE.SphereGeometry(5,32,32),d=new THREE.Mesh(l,m),d.position.y=o+24,d.position.z=10,d.position.x=a-10,d.matrixAutoUpdate=!1,d.updateMatrix(),p.add(d),l=new THREE.SphereGeometry(5,32,32),d=new THREE.Mesh(l,m),d.position.y=o+24,d.position.z=10,d.position.x=-a+10,d.matrixAutoUpdate=!1,d.updateMatrix(),p.add(d),p.position.x=4,p.position.z=-20,p.visible=!1,this.scene.add(p),this.shipHouse={mesh:p,dropdown:null,currPosBay:0,currPosZ:0}}},{key:"setCameraPosition",value:function f(e,t,i){return this.camera.position.z=i,this.camera.position.x=e,this.camera.position.y=t,this.controls.maxDistance=2*i,this.controls.minDistance=i/2,{x:e,y:t,z:i}}},{key:"resize3DViewer",value:function y(e,t){this.camera&&(this.width=e,this.height=t,this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t))}},{key:"loadModel",value:function b(e,t,i,n){var a=this,o=this.container,s=o.loadingDiv,d=this.appScene.options,l=void 0,c=void 0,u=void 0,h=void 0,p=void 0,v=void 0,m=void 0,f=function b(e){var t=e.loaded/(e.total||3e6);s.updateLoader(t,.3)},y=function E(e){var t=r.addEventDsptchr("modelLoaded");t.data={model:e},o.dispatchEvent(t),s.updateLoader(1,.5),setTimeout(function(){s.hide()},500)};return new Promise(function(e,o){var r=n.replace(".","_");return a._modelsLoaded[r]?void e(r):(s=a.container.loadingDiv,s.setPercentage(0),s.setMessage("Loading model..."),s.show(),v=new THREE.MTLLoader,v.setBaseUrl(t+"textures/"),v.setPath(t),void v.load(i,function(i){var s=void 0,d=void 0;i.preload(),m=new THREE.OBJLoader,m.setPath(t),m.setMaterials(i),m.load(n,function(t){var i=void 0,n=new THREE.Object3D;t.traverse(function(e){i=new THREE.Mesh(e.geometry,e.material),i.name=e.name,i.receiveShadow=!0,i.castShadow=!0,n.add(i)}),a._modelsLoaded[r]=n,y(),e(r)},f,function(e){window.alert("An error happened loading assets"),console.error(e),o()})}))})}},{key:"animate",value:function E(){function e(){requestAnimationFrame(e),t.controls.update(),t.render()}var t=this;e()}},{key:"render",value:function g(){var e=void 0,t=void 0,i=void 0,n=void 0,a=void 0;if(this._isRendering){if(this.frames+=1,1&this.frames)if(this.raycaster.setFromCamera(this.mouseVector.clone(),this.camera),e=this.raycaster.intersectObjects(this.containersGroup.children,!0),t=e.length,t>1){var o=this.appScene.data.containersIDs;i=e[1].object.name,null!==i&&void 0!==i&&(n=o[i],n&&e[1].object!==this._INTERSECTED&&(this._INTERSECTED&&(this._INTERSECTED.material=this._INTERSECTED.isBasic?this.basicMaterial:this.allMaterials[this._INTERSECTED.materialPos]),this._INTERSECTED=e[1].object,this._INTERSECTED.isBasic||(this._INTERSECTED.material=this.selectionMaterial),this.putInfoWindow(n)))}else this._INTERSECTED&&(this._INTERSECTED.material=this._INTERSECTED.isBasic?this.basicMaterial:this.allMaterials[this._INTERSECTED.materialPos],this._INTERSECTED=null);this.renderer.render(this.scene,this.camera)}}},{key:"putInfoWindow",value:function w(e){this.appScene._infoNode.innerHTML="<small>Position:</small> "+e.p+"<br /><small>ID:</small> "+e.c+"<br /><small>ISO:</small> "+e.i+(e.r?" / Reefer":"")+" <small>Status:</small> "+(e.s?"full":"empty")+"<br /><small>Carrier:</small> "+e.o+"<br /><small>POD:</small> "+e.d+"<br /><small>POL:</small> "+(e.f||"")+" <small>Weight:</small> "+e.m+"MT",this.appScene._bayNode.innerHTML="<small>bay</small> "+e.iBay}}]),e}();i.Renderer3D=l},{"../text2D/SpriteText2D.js":8,"../text2D/textAlign.js":9,"../utils/dom-utilities.js":10,"../utils/js-helpers.js":11}],6:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("../utils/js-helpers.js"),r=e("../utils/dom-utilities.js"),s=e("../utils/preloader.js"),d=e("./renderer.js"),l=e("./data-loader.js"),c=e("./models-factory.js"),u=e("./i18labels.js"),h=function(){function e(t,i,a,r,d){n(this,e);var c=this,u=o.getQueryParams(),h=1.1;this.options=o.extend({extraSep:.5,loaderColor:"#f2f2f2",loaderColorSucess:"#79e3da",colors:{background:13823736,sunlight:14869230},dampingFactorOut:.2,dampingFactorIn:.75,initialCameraPosition:{x:0,y:0,z:100},labelScale:8,screenshots:{width:600,height:600,format:"png",transparent:!0}},d),this.width=0,this.height=0,this._titleNode=i,this._bayNode=r,this._infoNode=a,this._node=function p(){var e=void 0,i=void 0,n=void 0,a=void 0;return e=document.createElement("div"),e.className="app3d-container",e.id="app3d-container-"+Math.round(1e5*Math.random()),i=document.createElement("div"),i.className="app3d-render-container",i.id=e.id+"-render",e.appendChild(i),e.divRenderC=i,n=document.createElement("div"),n.className="app3d-loading-div",n.id=e.id+"-loading-div",e.appendChild(n),a=document.createElement("div"),a.className="app3d-loading-div-text",a.id=e.id+"-loading-text",n.appendChild(a),e.loadingDiv=new s(n,a,100,c.options,"img-loader-logo"),t.appendChild(e),e}(),this.initialBay=u.bay,this.data=null,this.dataLoader=new l.DataLoader(this._node.loadingDiv),this.renderer3d=null,this.modelsFactory=null,this._init()}return a(e,[{key:"loadUrl",value:function t(e,i,n){return this.dataLoader.loadUrl(e,i,n)}},{key:"loadData",value:function i(e){return this.dataLoader.generateStructuredData(e)}},{key:"_init",value:function u(){var e=this,t=void 0,i=void 0,n=void 0,a=this._node,o=Detector.canvas&&Detector.webgl;return o?(this.updateSize(),this.renderer3d=new d.Renderer3D(this,this.width,this.height),this.renderer3d.init(),this.renderer3d.animate(),this.modelsFactory=new c.ModelsFactory(this),void r.addEventLnr(window,"resize",function(){e.updateSize()})):(a.loadingDiv.show(),void a.loadingDiv.setMessage(a.parentNode.getAttribute(window.WebGLRenderingContext?"data-webgl":"data-gpu")))}},{key:"updateHtmlTitle",value:function h(e,t,i){var n=this,a=void 0;n._titleNode&&(a=(e?e:"")+(t?" / "+t:"")+(i?" / "+i:""),a?(n._titleNode.innerHTML=a,document.title=a+" / "+document.title):n._titleNode.style.display="none")}},{key:"getDimensions",value:function p(){return{width:this.width,height:this.height}}},{key:"_setDimensions",value:function v(e,t){this.width=e,this.height=t}},{key:"updateSize",value:function m(){var e=void 0,t=void 0,i=void 0,n=void 0,a=void 0,o=void 0;e=this._node,t=e.parentNode,null!==t&&void 0!==t&&(n=this.getDimensions(),a=t.offsetWidth,o=t.offsetHeight,n.width===a&&n.height===o||(e.style.width=a+"px",e.style.height=o+"px",this.renderer3d&&this.renderer3d.resize3DViewer(a,o),this._setDimensions(a,o),i=r.addEventDsptchr("resize"),this._node.dispatchEvent(i)))}},{key:"pauseRendering",value:function f(){this.renderer3d&&(this.renderer3d._isRendering=!1)}},{key:"resumeRendering",value:function y(){this.renderer3d&&(this.renderer3d._isRendering=!0)}},{key:"generateScreenshot",value:function b(){var e=arguments.length<=0||void 0===arguments[0]?this.options.screenshots.width:arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.options.screenshots.height:arguments[1],i=arguments.length<=2||void 0===arguments[2]?this.options.screenshots.format:arguments[2],n=arguments.length<=3||void 0===arguments[3]?this.options.screenshots.transparent:arguments[3];return data}}]),e}();i.VesselsApp3D=h},{"../utils/dom-utilities.js":10,"../utils/js-helpers.js":11,"../utils/preloader.js":12,"./data-loader.js":2,"./i18labels.js":3,"./models-factory.js":4,"./renderer.js":5}],7:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){var t=r[e];if(!t){var i=document.getElementsByTagName("body")[0],n=document.createElement("div"),a=document.createTextNode("span");n.appendChild(a),n.setAttribute("style","font:"+e+";position:absolute;top:0;left:0"),i.appendChild(n),t=n.offsetHeight,r[e]=t,i.removeChild(n)}return t}var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r={},s=function(){function e(){n(this,e),this.textWidth=null,this.textHeight=null,this.canvas=document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}return o(e,[{key:"drawText",value:function t(e,i){return this.ctx.font=i.font,this.textWidth=Math.ceil(this.ctx.measureText(e).width),this.textHeight=a(this.ctx.font),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=i.fillStyle,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font=i.font,this.ctx.fillStyle="#000",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e,this.canvas.width/2,this.canvas.height/2),this.canvas}},{key:"width",get:function i(){return this.canvas.width}},{key:"height",get:function r(){return this.canvas.height}}]),e}();t.exports=s},{}],8:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function c(e,t,i){for(var n=!0;n;){var a=e,o=t,r=i;n=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,o);if(void 0!==s){if("value"in s)return s.value;var d=s.get;if(void 0===d)return;return d.call(r)}var l=Object.getPrototypeOf(a);if(null===l)return;e=l,t=o,i=r,n=!0,s=l=void 0}},s=e("./textAlign.js"),d=e("./CanvasText.js"),l=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];n(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._font=i.font||"30px Arial",this._fillStyle=i.fillStyle||"#FFFFFF",this.canvas=new d,this.align=i.align||s.center,this.antialias=!0,this.text=e}return a(t,e),o(t,[{key:"updateText",value:function i(){this.canvas.drawText(this._text,{font:this._font,fillStyle:this._fillStyle}),this.cleanUp(),this.texture=new THREE.Texture(this.canvas.canvas),this.texture.needsUpdate=!0,this.applyAntiAlias(),this.material?this.material.map=this.texture:this.material=new THREE.SpriteMaterial({map:this.texture}),this.sprite||(this.sprite=new THREE.Sprite(this.material),this.geometry=this.sprite.geometry,this.add(this.sprite))}},{key:"cleanUp",value:function l(){this.texture&&this.texture.dispose()}},{key:"applyAntiAlias",value:function c(){this.antialias===!1&&(this.texture.magFilter=THREE.NearestFilter,this.texture.minFilter=THREE.LinearMipMapLinearFilter)}},{key:"width",get:function u(){return this.canvas.textWidth}},{key:"height",get:function h(){return this.canvas.textHeight}},{key:"text",get:function p(){return this._text},set:function v(e){this._text!==e&&(this._text=e,this.updateText())}},{key:"font",get:function m(){return this._font},set:function f(e){this._font!==e&&(this._font=e,this.updateText())}},{key:"fillStyle",get:function y(){return this._fillStyle},set:function b(e){this._fillStyle!==e&&(this._fillStyle=e,this.updateText())}}]),t}(THREE.Object3D);t.exports=l},{"./CanvasText.js":7,"./textAlign.js":9}],9:[function(e,t,i){"use strict";t.exports={center:new THREE.Vector2(0,0),left:new THREE.Vector2(1,0),topLeft:new THREE.Vector2(1,-1),topRight:new THREE.Vector2(-1,-1),right:new THREE.Vector2(-1,0),bottomLeft:new THREE.Vector2(1,1),bottomRight:new THREE.Vector2(-1,1)}},{}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function s(e){return e&&e.tagName&&("textarea"===e.tagName.toLowerCase()||"input"===e.tagName.toLowerCase()&&"text"===e.type.toLowerCase())};i.isInputOrTextarea=n;var a=function d(e){return"object"==typeof HTMLElement?id instanceof HTMLElement:"object"==typeof id&&1===id.nodeType&&"string"==typeof id.nodeName};i.isHtmlNode=a;var o=function l(e,t,i){window.attachEvent?(e["e"+t+i]=i,e[t+i]=function(){e["e"+t+i](window.event)},e.attachEvent("on"+t,e[t+i])):e.addEventListener(t,i,!1)};i.addEventLnr=o;var r=function c(e){if(window.Event&&"function"==typeof window.Event)return new Event(e);var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t};i.addEventDsptchr=r},{}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function h(e){return Array.isArray?Array.isArray(e):e instanceof Array};i.isArray=n;var a=function p(e,t){var i=void 0,n=JSON.parse(JSON.stringify(e));if(t)for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&Object.prototype.hasOwnProperty.call(n,i)&&(n[i]=t[i]);return n};i.extend=a;var o=function v(e,t){return e-t};i.sortNumeric=o;var r=function m(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],i=arguments.length<=2||void 0===arguments[2]?!0:arguments[2],n=e;return t&&(n=n.replace(/^\s\s*/,"")),i&&(n=n.replace(/\s\s*$/,"")),n};i.trimString=r;var s=function f(e){var t=void 0,i=void 0,n=new Set;for(t=0,i=e.length;i>t;t+=1){var a=r(e[t]);n.has(a)||n.add(a)}return ouputSet};i.arrayToSet=s;var d=function y(e,t){var i=void 0,n=[];for(i in e)n.push(i);return t&&(n=n.sort(o)),n};i.objKeysToArray=d;var l=function b(e){var t=Number(e).toString(16);return t="000000".substr(0,6-t.length)+t,t.toUpperCase()};i.decimalToHex=l;var c=function E(e,t){var i="000"+String(e);return i.substr(i.length-t)};i.pad=c;var u=function g(){for(var e=document.location.search.split("+").join(" "),t={},i=void 0,n=/[?&]?([^=]+)=([^&]*)/g;i=n.exec(e);)t[decodeURIComponent(i[1])]=decodeURIComponent(i[2]);return t};i.getQueryParams=u},{}],12:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t,i,a,o,r,s){void 0===t&&(t=mandatory()),n(this,e);var d=void 0;null!==t&&void 0!==t&&(this.node=t,d=document.createElement("canvas"),this.messages=i,this.canv=d,this.ctx=d.getContext("2d"),this.loadCurrent=0,this.radius=a,this.canv.width=Math.round(2*a),this.canv.height=Math.round(2*a),this.setPixelRatio(),this.opts=o,this.node.appendChild(d),this.image=r?document.getElementById(r):null,s&&this.setMessage(s))}return a(e,[{key:"rectLoader",value:function t(){var e=this.loadCurrent,t=this.ctx,i=this.radius,n=2*i,a=Math.round(i/2),o=2*e*Math.PI,r=this.opts;t.clearRect(0,0,n,n),t.beginPath(),t.arc(i,i,a,0,2*Math.PI,!1),t.fillStyle=r.loaderColor,t.fill(),t.lineWidth=1,t.strokeStyle=r.loaderColor,t.stroke(),t.beginPath(),t.arc(i,i,Math.round(a/2),0,o,!1),t.lineWidth=a,t.strokeStyle=r.loaderColorSucess,t.stroke(),this.image&&t.drawImage(this.image,a,a,i,i)}},{key:"setPixelRatio",value:function i(){var e=void 0,t=void 0,i=this.ctx,n=window.devicePixelRatio||1,a=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,o=n/a;n!==a&&(e=this.canv.width,t=this.canv.height,this.canv.width=e*o,this.canv.height=t*o,this.canv.style.width=e+"px",this.canv.style.height=t+"px",this.ctx.scale(o,o))}},{key:"setMessage",value:function o(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];this.messages&&(this.messages.innerHTML=e,this.messages.style.color=t?"red":"")}},{key:"updateLoader",value:function r(e,t){var i=this;i.node&&TweenLite.to(i,t,{loadCurrent:e,ease:Power1.easeInOut,onUpdate:i.rectLoader,onUpdateScope:i})}},{key:"startAnimation",value:function s(){this.node&&(this.rectLoader(),this.updateLoader(.4,2))}},{key:"stopAnimation",value:function d(){this.node&&this.updateLoader(1,.25)}},{key:"setPercentage",value:function l(e){this.node&&(this.loadCurrent=e,this.rectLoader())}},{key:"show",value:function c(){this.node&&(this.node.style.display="block")}},{key:"hide",value:function u(){this.node&&(this.node.style.display="none")}}],[{key:"mandatory",value:function h(){throw new Error("Missing parameter")}}]),e}();i["default"]=o,t.exports=i["default"]},{}],13:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(){n(this,e),this.hue=Math.random(),this.goldenRatio=.618033988749895,this.hexwidth=2}return a(e,[{key:"hsvToRgb",value:function t(e,i,n){var a=Math.floor(6*e),o=6*e-a,r=n*(1-i),s=n*(1-o*i),d=n*(1-(1-o)*i),l=255,c=255,u=255;switch(a){case 0:l=n,c=d,u=r;break;case 1:l=s,c=n,u=r;break;case 2:l=r,c=n,u=d;break;case 3:l=r,c=s,u=n;break;case 4:l=d,c=r,u=n;break;case 5:l=n,c=r,u=s}return[Math.floor(256*l),Math.floor(256*c),Math.floor(256*u)]}},{key:"padHex",value:function i(e){return e.length>this.hexwidth?e:new Array(this.hexwidth-e.length+1).join("0")+e}},{key:"get",value:function o(e,t,i){this.hue+=this.goldenRatio,this.hue%=1,"number"!=typeof t&&(t=.5),"number"!=typeof i&&(i=.95);var n=this.hsvToRgb(this.hue,t,i);return e?"#"+this.padHex(n[0].toString(16))+this.padHex(n[1].toString(16))+this.padHex(n[2].toString(16)):n}}]),e}();i.RColor=o},{}]},{},[1]);